dist: xenial
language: cpp
compiler:
- gcc

matrix:
  include:
    - os: linux
      addons:
        apt:
          packages:
            - flex
            - bison
            - make
            - libboost-all-dev
            - libgsl-dev
            - ghc
    - os: osx
      addons:
        homebrew:
          update: true
          packages:
            - flex
            - bison@2.7
            - make
            - boost
            - gsl
            - ghc
            - gnu-sed

install:
  # actually use brew install version of programs
  - if [ $TRAVIS_OS_NAME = osx ]; then export PATH="/usr/local/opt/flex/bin:/usr/local/opt/bison@2.7/bin:/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"; fi
  - ./configure
  - if [ $TRAVIS_OS_NAME = osx ]; then sed -i "s/-D_XOPEN_SOURCE=500//" config.mf
  - if [ $TRAVIS_OS_NAME = osx ]; then make LDFLAGS_EXTRA=" -L/usr/local/opt/bison@2.7/lib -L/usr/local/opt/flex/lib " CPPFLAGS_EXTRA=" -I/usr/local/opt/flex/include "; fi
  - if [ $TRAVIS_OS_NAME = linux]; then make; fi
  - sudo make install
before_script:
  # install missing ghc/haskell modules
  - sudo apt-get install cabal-install -y
  - cabal update
  - cabal install random
  # obtain truth data from secondary github repository
  - git clone https://github.com/jlab/gapc-test-suite.git /home/travis/gapc-test-suite
script:
  - make test-unit
  - make test-paral
  - if [ $TRAVIS_OS_NAME = osx ]; then make test-mod TRUTH_DIR=/home/travis/gapc-test-suite/Truth TRUTH_SUFFIX=_osx; fi
  - if [ $TRAVIS_OS_NAME = linux ]; then make test-mod TRUTH_DIR=/home/travis/gapc-test-suite/Truth TRUTH_SUFFIX=_ubuntu; fi
  - make test-regress TRUTH_DIR=/home/travis/gapc-test-suite/Truth
  - make test-ambiguity TRUTH_DIR=/home/travis/gapc-test-suite/Truth
